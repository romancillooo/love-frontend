<section class="letter-wrapper">
  @if (isLoading) {
  <div class="letter-status">
    <p>Cargando cartaâ€¦</p>
  </div>
  } @else if (loadError) {
  <div class="letter-status" role="alert">
    <p>{{ loadError }}</p>
    <button type="button" class="btn secondary" (click)="goBack()">Volver a las cartas</button>
  </div>
  } @else if (letter) {
  <article [class]="getContainerClass()">
    <header class="letter-header">
      <span class="letter-icon">{{ letter.icon }}</span>
      <div class="letter-heading">
        <h1 class="title">{{ letter.title }}</h1>
        <p class="subtitle">Escrita con todo mi amor para ti ðŸ’Œ</p>
      </div>
    </header>

    <p class="letter-text" [innerText]="displayText"></p>

    <footer class="letter-footer">
      <div class="reactions-area">
        <app-reaction-badge
          [reactions]="letter.reactions || []"
          [variant]="isUserLetter ? 'user' : 'default'"
          (badgeClick)="toggleReactionsDrawer()"
        ></app-reaction-badge>

        <div class="reaction-trigger">
          <button 
            type="button" 
            class="react-btn" 
            (click)="toggleEmojiPicker($event)"
            [class.active]="myReaction"
          >
            <span class="btn-icon">{{ myReaction || 'â˜º' }}</span>
            <span class="btn-label">{{ myReaction ? 'Tu reacciÃ³n' : 'Reaccionar' }}</span>
          </button>
          
          <app-emoji-picker
            [visible]="showEmojiPicker"
            [currentEmoji]="myReaction"
            (emojiSelect)="onReact($event)"
          ></app-emoji-picker>
        </div>
      </div>

      <p class="author-sign">Con amor infinito, {{ letter.createdBy?.displayName || letter.createdBy?.username || 'tu amor' }}.</p>
    </footer>
  </article>

  <!-- ðŸ”¹ Drawer de Reacciones -->
  <app-reactions-drawer
    [isOpen]="showReactionsDrawer"
    [reactions]="letter.reactions || []"
    (closeDrawer)="toggleReactionsDrawer()"
  ></app-reactions-drawer>
  }
</section>
