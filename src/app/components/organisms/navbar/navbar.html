<nav class="navbar" *ngIf="isRouteAllowed" [class.hidden]="!isVisible">
  <div class="navbar-content">
    <div class="primary-row">
      <!-- üîπ Lado izquierdo -->
      <div class="left-slot">
        <button
          *ngIf="showBackButton"
          class="back-btn icon-btn"
          type="button"
          (click)="goBack()"
          aria-label="Volver"
        >
          <mat-icon>arrow_back</mat-icon>
        </button>

        <button
          class="menu-toggle icon-btn"
          type="button"
          (click)="toggleMenu()"
          aria-label="Abrir men√∫"
        >
          <mat-icon>{{ menuOpen() ? 'close' : 'menu' }}</mat-icon>
        </button>
      </div>

      <!-- üîπ Bot√≥n "+" con men√∫ desplegable para /photos -->
      <div *ngIf="isPhotosRoute" class="upload-menu-container">
        <!-- üóëÔ∏è Bot√≥n Eliminar (solo visible si hay selecci√≥n) -->
        <button
          *ngIf="isSelectionMode() && selectionCount() > 0"
          class="delete-btn icon-btn"
          type="button"
          (click)="triggerBatchDelete()"
          aria-label="Eliminar seleccionados"
        >
          <mat-icon>delete</mat-icon>
        </button>

        <button
          class="upload-btn icon-btn"
          type="button"
          (click)="toggleUploadMenu()"
          aria-label="Subir contenido"
          [class.is-active]="uploadMenuOpen()"
        >
          <mat-icon>{{ isSelectionMode() ? 'close' : 'add' }}</mat-icon>
        </button>

        <!-- üå∏ Bot√≥n "+" EXTRA para acciones en lote (Solo visible si hay selecci√≥n) -->
        <div class="batch-actions-wrapper" *ngIf="isSelectionMode() && selectionCount() > 0">
          <button
            class="batch-btn icon-btn"
            type="button"
            (click)="toggleBatchActions()"
            [class.is-active]="batchActionsOpen()"
            aria-label="Opciones de selecci√≥n"
          >
            <mat-icon>add</mat-icon>
          </button>

          <!-- Dropdown de acciones en lote -->
          <div class="upload-dropdown batch-dropdown" *ngIf="batchActionsOpen()">
            <button type="button" class="dropdown-item" (click)="requestBatchAddToAlbum()">
              <mat-icon>photo_album</mat-icon>
              <span>Agregar a √°lbum</span>
            </button>
            <button type="button" class="dropdown-item" (click)="requestBatchDownload()">
              <mat-icon>download</mat-icon>
              <span>Descargar</span>
            </button>
          </div>
        </div>

        <!-- Men√∫ desplegable principal -->
        <div class="upload-dropdown" *ngIf="uploadMenuOpen()">
          <button type="button" class="dropdown-item" (click)="openImageUploader()">
            <mat-icon>photo_library</mat-icon>
            <span>Subir Recuerdos</span>
          </button>
          <button type="button" class="dropdown-item" (click)="openAlbumCreator()">
            <mat-icon>photo_album</mat-icon>
            <span>Crear Nuevo √Ålbum</span>
          </button>
          <button type="button" class="dropdown-item" (click)="enableSelectionMode()">
            <mat-icon>checklist_rtl</mat-icon>
            <span>Seleccionar</span>
          </button>
        </div>
      </div>

      <!-- üîπ Bot√≥n "+" para crear carta en /letters (solo superadmin) -->
      <div *ngIf="isLettersRoute && isSuperAdmin()" class="upload-menu-container">
        <button
          class="upload-btn icon-btn"
          type="button"
          (click)="openLetterCreator()"
          aria-label="Crear nueva carta"
        >
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>

    <!-- üîπ Enlaces -->
    <div class="nav-links" [class.is-open]="menuOpen()">
      <a
        *ngFor="let link of navigationLinks"
        routerLinkActive="is-active"
        [routerLinkActiveOptions]="{ exact: true }"
        [routerLink]="link.route"
        class="nav-link"
        [class.is-current]="activeNavRoute === link.route"
        (click)="closeMenu()"
      >
        <mat-icon>{{ link.icon }}</mat-icon>
        <span>{{ link.label }}</span>
      </a>

      <button type="button" class="nav-link logout-link" (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Salir</span>
      </button>
    </div>
  </div>
</nav>

<!-- üîπ Overlay mobile -->
<div class="navbar-overlay" *ngIf="menuOpen()" (click)="closeMenu()"></div>

<!-- üîπ Overlay para cerrar men√∫ de upload -->
<div class="upload-menu-overlay" *ngIf="uploadMenuOpen()" (click)="closeUploadMenu()"></div>
<div class="upload-menu-overlay" *ngIf="batchActionsOpen()" (click)="closeBatchActions()"></div>

<!-- üîπ Modal de crear √°lbum -->
<app-album-creator
  *ngIf="showAlbumCreator()"
  (close)="closeAlbumCreator()"
  (create)="onCreateAlbum($event)"
></app-album-creator>

<!-- üîπ Modal de crear carta -->
<app-letter-creator
  *ngIf="showLetterCreator()"
  (close)="closeLetterCreator()"
  (create)="onCreateLetter($event)"
></app-letter-creator>
