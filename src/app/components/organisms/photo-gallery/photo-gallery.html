<!-- src/app/components/organisms/photo-gallery/photo-gallery.html -->
<section class="gallery-container">
  <!-- üå∏ Encabezado -->
  <header class="gallery-header">
    <div class="gallery-heading">
      <h1 class="gallery-title">Nuestros recuerdos</h1>
      <p class="gallery-subtitle">
        Elige un momento para revivirlo. Las fotos m√°s recientes aparecen primero.
      </p>
    </div>

    <!-- üîπ Filtros -->
    <div
      class="gallery-filters"
      aria-label="Filtrar fotos"
      [class.can-scroll]="shouldEnableFilterScroll"
    >
      <!-- Favoritos -->
      <button
        type="button"
        class="filter-chip"
        [class.is-active]="activeFilter === 'favorites'"
        (click)="applyFilter('favorites')"
      >
        <span class="filter-icon">‚ù§Ô∏è</span>
        <span class="filter-label">Favoritos</span>
      </button>

      <!-- Todos -->
      <button
        type="button"
        class="filter-chip"
        [class.is-active]="activeFilter === 'all'"
        (click)="applyFilter('all')"
      >
        Todos
      </button>

      <!-- √Ålbumes -->
      @for (album of albums; track album.id) {
      <button
        type="button"
        class="filter-chip"
        [class.is-active]="isAlbumActive(album.id)"
        (click)="applyAlbumFilter(album.id)"
      >
        <span class="filter-label">{{ album.name }}</span>
      </button>
      }
    </div>
  </header>

  <!-- üî∏ Estado: Cargando -->
  @if (isSkeletonVisible && !loadError) {
  <div class="gallery-skeleton" aria-hidden="true">
    @for (placeholder of skeletonPlaceholders; track placeholder) {
    <div class="skeleton-card"></div>
    }
    <p class="skeleton-message">Cargando recuerdos‚Ä¶</p>
  </div>
  }

  <!-- üî∏ Estado: Error -->
  @if (loadError) {
  <div class="gallery-error" role="alert">
    <p>{{ loadError }}</p>
    <button type="button" class="btn secondary" (click)="retryLoading()">Reintentar</button>
  </div>
  } @else {
  <!-- üî∏ Estado: Sin resultados -->
  @if (photos.length === 0) {
  <div class="gallery-empty">
    @if (activeFilter === 'favorites') {
      <p>A√∫n no tienes fotos favoritas. ¬°Marca algunas con el coraz√≥n! ‚ù§Ô∏è</p>
    } @else if (isAlbumSelectedWithoutPhotos()) {
      <p>No encontr√© recuerdos en este √°lbum. Prueba con otra opci√≥n preciosa üíñ</p>
      <button type="button" class="btn" (click)="applyFilter('all')">
        Agregar Fotos
      </button>
    } @else {
      <p>No encontr√© recuerdos para ese filtro. Prueba con otra opci√≥n preciosa üíñ</p>
    }
  </div>
  } @else {
  <!-- üîπ Grid de fotos -->
  <div class="gallery-grid" [class.is-loading]="isSkeletonVisible">
    @for (photo of photos; track photo.id) {
    <div class="gallery-item" [class.is-loaded]="hasPhotoLoaded(photo.id)">
      <app-photo-card
        [photo]="photo"
        (openPreview)="openPreview($event)"
        (imageLoaded)="onPhotoLoaded($event)"
      ></app-photo-card>
    </div>
    }
  </div>
  } }

  <!-- üå∏ Modal de vista previa -->
  @if (selectedPhoto) {
<app-photo-preview
  [photo]="selectedPhoto"
  [hasNext]="hasNextPhoto"
  [hasPrevious]="hasPreviousPhoto"
  [index]="selectedIndex"
  [total]="photos.length"
  [albumContextId]="currentAlbumId"
  [albumContextName]="currentAlbumName"
  [isRemoveFromAlbumBusy]="isRemoveFromAlbumLoading"
  (close)="closePreview()"
  (next)="showNextPhoto()"
  (previous)="showPreviousPhoto()"
  (requestDelete)="photoPendingDeletion = $event; confirmPhotoDeleteVisible = true"
  (requestAddToAlbum)="onRequestAddToAlbum($event)"
  (requestRemoveFromAlbum)="onRequestRemoveFromAlbum($event)"
  (toggleFavorite)="onToggleFavorite($event)"
></app-photo-preview>
  }

  <!-- üíñ Loader global (overlay fijo) -->
  <app-love-loader
    class="gallery-loader-overlay"
    [visible]="isLoaderVisible"
    [message]="loaderMessage"
    [gifSrc]="'/assets/love-loader.gif'"
  ></app-love-loader>
</section>

@if (showAlbumCreator) {
<app-album-creator
  [initialAlbum]="albumBeingEdited"
  (close)="closeAlbumEditor()"
  (update)="onAlbumUpdate($event)"
  (remove)="onAlbumRemove($event)"
></app-album-creator>
}

<app-confirm-dialog
  [visible]="confirmDeleteVisible"
  title="¬øEliminar √°lbum?"
  message="Esta acci√≥n eliminar√° el √°lbum y no podr√°s recuperarlo."
  confirmText="S√≠, eliminar"
  cancelText="Cancelar"
  (confirm)="confirmAlbumRemoval()"
  (cancel)="cancelAlbumRemoval()"
></app-confirm-dialog>

@if (showSelectAlbumModal) {
<app-select-album
  [photoId]="photoIdForAlbum"
  [photoLabel]="photoLabelForAlbum"
  [isBusy]="isAddToAlbumLoading"
  (close)="cancelAlbumSelection()"
  (confirm)="addPhotoToSelectedAlbums($event)"
></app-select-album>
}

<app-confirm-dialog
  [visible]="confirmPhotoDeleteVisible"
  title="¬øEliminar este recuerdo?"
  message="Si eliminas esta foto, se borrar√° para siempre de tus recuerdos."
  confirmText="S√≠, eliminar"
  cancelText="Cancelar"
  (confirm)="confirmPhotoRemoval()"
  (cancel)="cancelPhotoRemoval()"
></app-confirm-dialog>

<app-confirm-dialog
  [visible]="confirmRemoveFromAlbumVisible"
  [title]="'Quitar de ' + (albumNameForRemoval || 'este √°lbum') + '?'"
  [message]="'La foto dejar√° de aparecer en este √°lbum, pero seguir√° existiendo en tu galer√≠a.'"
  confirmText="S√≠, quitar"
  cancelText="Cancelar"
  (confirm)="confirmRemoveFromAlbum()"
  (cancel)="cancelRemoveFromAlbum()"
></app-confirm-dialog>
